<%= header("../", project_name) %>
<div class="row center-block not-full-width">
  <div class="col-md-12">
    <%= project_intro %>
    <p>We show the original&nbsp;<a href="https://ocaml.org/">OCaml</a> code on the left and the imported&nbsp;<a href="https://coq.inria.fr/">Coq</a> code on the right. The imported code does <%= "not necessarily " unless status == :does_compile %>compile. Warnings reported on the&nbsp;OCaml side are due to either various incompleteness in our tool, or to side-effects in the source code. Go on the <a href="https://gitter.im/clarus/coq-of-ocaml">Gitter chat</a> for more information. Work currently made at <a href="https://www.nomadic-labs.com/">Nomadic Labs</a>.</p>
    <p>To install the latest development version of <a href="https://clarus.github.io/coq-of-ocaml/">coq-of-ocaml</a> with <a href="https://opam.ocaml.org/">opam</a>:</p>
    <pre><code>opam repo add coq-released https://coq.inria.fr/opam/released
opam pin add https://github.com/clarus/coq-of-ocaml.git#master</code></pre>
    <ul>
      <li>OCaml size: <%= nb_ocaml_lines %> lines</li>
      <li>Coq size: <%= nb_coq_lines %> lines (<%= "+" if nb_coq_lines >= nb_ocaml_lines %><%= "#{100 * nb_coq_lines / nb_ocaml_lines - 100}%" %> compared to&nbsp;OCaml)</li>
      <li>Warnings from coq-of-ocaml: <%= nb_errors %></li>
    </ul>
    <% if chart_data then %>
      <canvas id="chart" width="400" height="400"></canvas>
      <script>
        window.chart = <%= chart_data %>;
      </script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
      <script src="../js/display-chart.js"></script>
    <% end %>
    <% if project_name == :tezos then %>
      <img
        alt="Minion mic drop"
        class="img-responsive img-rounded center-block"
        src="https://media.giphy.com/media/DfbpTbQ9TvSX6/source.gif"
        style="margin-top: 60px; margin-bottom: 60px;"
      />
    <% end %>
  </div>
</div>
<% if conversions.size >= 2 then %>
<hr />
<div class="row" style="margin: 20px;">
  <h3>List of files</h3>
  <p>We add the warnings from coq-of-ocaml as annotations. They are not necessarly related to compilation bugs of the generated Coq files. These warnings are either due to unsupported features in coq-of-ocaml or to side-effects in the source code.</p>
  <% column_size = conversions.size / 3 %>
  <% column_size += 1 if conversions.size % 3 != 0 %>
  <% 3.times do |i| %>
  <div class="col-md-4">
    <ul>
      <% for conversion in conversions[i * column_size..(i + 1) * column_size - 1] do %>
      <li>
        <a href="#<%= u(conversion[:ocaml_name]) %>"><%= h(conversion[:ocaml_name]) %></a>&nbsp;<%= conversion[:nb_errors] == 0 ? "<span class=\"label label-success\">âœ“</span>" : "<span class=\"label label-warning\">#{conversion[:nb_errors]}</span>" %>
      </li>
      <% end %>
    </ul>
  </div>
  <% end %>
</div>
<% end %>
<% for conversion in conversions do %>
<hr />
<div class="row conversion-row" id="<%= u(conversion[:ocaml_name]) %>">
  <div style="margin: 20px;">
    <h3><%= h(conversion[:coq_name][0..-3]) %></h3>
    <ul>
      <li>OCaml size: <%= conversion[:ocaml_size] %> lines</li>
      <li>Coq size: <%= conversion[:coq_size] %> lines (<%= "+" if conversion[:coq_size] >= conversion[:ocaml_size] %><%= "#{100 * conversion[:coq_size] / conversion[:ocaml_size] - 100}%" %> compared to&nbsp;OCaml)</li>
    </ul>
  </div>
  <div class="col-md-6">
    <a href="#<%= u(conversion[:ocaml_name]) %>"><code><%= h(conversion[:ocaml_name]) %></code></a>&nbsp;<span class="label label-<%= conversion[:nb_errors] == 0 ? "success" : "warning" %>"><%= conversion[:nb_errors] == 0 ? "success" : "#{conversion[:nb_errors]} warning#{conversion[:nb_errors] != 1 ? "s" : ""}" %></span>
    <% if conversion[:global_errors].size != 0 then %>
      <div class="alert alert-warning global-errors" role="alert">
        <ul>
          <% for global_error in conversion[:global_errors] do %>
            <li><%= h(global_error) %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <pre><%= conversion[:ocaml_content] %></pre>
  </div>
  <div class="col-md-6">
    <a href="#<%= u(conversion[:ocaml_name]) %>"><code><%= h(conversion[:coq_name]) %></code></a>
    <pre><%= h(conversion[:coq_content]) %></pre>
  </div>
</div>
<% end %>
<%= footer("../") %>
